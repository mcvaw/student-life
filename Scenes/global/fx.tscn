[gd_scene load_steps=4 format=2]

[ext_resource path="res://Audio/fx/button_click_01.wav" type="AudioStream" id=1]
[ext_resource path="res://Audio/fx/Dark and sweet.wav" type="AudioStream" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends AudioStreamPlayer

# Обрабатывает воспроизведение звуков
# Звуки воспроизводятся независимо друг от друга

# Воспроизвести звук (параллельно):
# get_node(\"/root/fx\").play_sound(sound)

# Воспроизвести нажатие на кнопку 
# (просто сокращение для удобства):
# get_node(\"/root/fx\").btn_click()


var num = 0
export (AudioStream) var btn_click_sound
export (AudioStream) var dialog_sound
var volume : float setget set_volume, get_volume


func set_volume(value : float) -> void:
	volume = value
	AudioServer.set_bus_volume_db(2, volume)


func get_volume() -> float:
	return volume


func destroy(name : int) -> void:
	var player = get_node(str(name))
	remove_child(player)


# Нажатие на кнопку
func btn_click() -> void:
	play_sound(btn_click_sound)


# Активация диалога
func dialog() -> void:
	play_sound(dialog_sound)


func play_sound(obj : AudioStream) -> void:
	# Понять, можно ли обратиться к этому источнику
	if (!self.playing):
		self.stream = obj
		self.play()
	# Создать дополнительный источник
	else:
		var player : = AudioStreamPlayer.new()
		player.name = str(num)
		player.stream = obj
		player.bus = \"FX\"
		var state = player.connect(\"finished\", self, \"destroy\", [num])
		assert(state == OK)
		add_child(player)
		get_node(str(num)).play()
		num += 1
"

[node name="AudioStreamPlayer" type="AudioStreamPlayer"]
bus = "FX"
script = SubResource( 1 )
btn_click_sound = ExtResource( 1 )
dialog_sound = ExtResource( 2 )
